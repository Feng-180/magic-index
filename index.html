<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AI Copilot</title>
    <style>
        /* --- Copilot é£æ ¼å®šä¹‰ --- */
        :root {
            --bg-color: #f0f2f5; /* æŸ”å’Œæµ…ç°èƒŒæ™¯ï¼Œå¦‚éœ€æ·±è‰²æ¨¡å¼å¯æ”¹ä¸º #1e1e1e */
            --chat-bg: #ffffff;
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%); /* Copilot è“ç´«æ¸å˜ */
            --user-text: #ffffff;
            --ai-text: #1f2937;
            --ai-bubble: #e4e6eb; /* æµ…ç°æ°”æ³¡ */
            --input-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* æ·±è‰²æ¨¡å¼é€‚é…ï¼ˆå¯é€‰ï¼Œæ£€æµ‹ç³»ç»Ÿè®¾ç½®ï¼‰ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #121212;
                --chat-bg: #1e1e1e;
                --ai-text: #e0e0e0;
                --ai-bubble: #2d2d2d;
            }
        }

        body { 
            margin: 0; padding: 0; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex; justify-content: center; height: 100vh; overflow: hidden; 
        }

        .app { 
            width: 100%; max-width: 800px; display: flex; flex-direction: column; 
            background: var(--bg-color); 
            height: 100%; position: relative; 
        }
        
        /* é¡¶éƒ¨å¯¼èˆªï¼šæç®€é€æ˜ */
        .header { 
            padding: 15px 20px; 
            text-align: center; 
            font-weight: 600; 
            color: var(--ai-text);
            background: transparent;
            display: flex; justify-content: center; align-items: center; 
            flex-shrink: 0;
            padding-top: max(15px, env(safe-area-inset-top)); /* é¿å¼€åˆ˜æµ· */
            font-size: 18px;
            letter-spacing: 0.5px;
        }
        
        .reset-btn { 
            position: absolute; right: 20px;
            font-size: 13px; color: #9ca3af; cursor: pointer; padding: 5px; 
            background: rgba(0,0,0,0.05); border-radius: 12px;
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-box { 
            flex: 1; overflow-y: auto; padding: 20px; 
            display: flex; flex-direction: column; gap: 20px; 
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch; 
        }
        
        /* æ¶ˆæ¯å®¹å™¨ */
        .msg { display: flex; align-items: flex-start; gap: 12px; max-width: 85%; opacity: 0; animation: slideUp 0.3s forwards; }
        .msg.user { align-self: flex-end; flex-direction: row-reverse; }
        
        /* å¤´åƒ */
        .avatar { 
            width: 32px; height: 32px; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 16px; flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .msg.ai .avatar { background: #fff; color: #764ba2; border: 1px solid rgba(0,0,0,0.1); }
        .msg.user .avatar { background: var(--primary-gradient); color: #fff; }
        
        /* æ°”æ³¡ */
        .bubble { 
            padding: 12px 16px; border-radius: 18px; line-height: 1.6; font-size: 16px; 
            position: relative; word-wrap: break-word; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        /* AI æ°”æ³¡ï¼šåœ†æ¶¦ã€ç°è‰² */
        .msg.ai .bubble { 
            background: var(--ai-bubble); color: var(--ai-text); 
            border-top-left-radius: 4px; /* ç±»ä¼¼å¾®ä¿¡/Copilotçš„å°å°–è§’æ„Ÿ */
        }
        
        /* ç”¨æˆ·æ°”æ³¡ï¼šæ¸å˜è‰² */
        .msg.user .bubble { 
            background: var(--primary-gradient); color: var(--user-text); 
            border-top-right-radius: 4px;
        }
        
        /* åº•éƒ¨è¾“å…¥åŒºï¼šæ‚¬æµ®æ„Ÿ */
        .input-area { 
            padding: 15px 20px; 
            background: transparent; /* é€æ˜èƒŒæ™¯ */
            display: flex; flex-direction: column; gap: 10px; 
            padding-bottom: max(20px, env(safe-area-inset-bottom)); flex-shrink: 0; 
        }
        
        #api-key-container { display: none; margin-bottom: 10px; }
        #api-key { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; 
            background: #fff; font-size: 14px; text-align: center; box-sizing: border-box;
        }
        
        /* è¾“å…¥æ¡†å®¹å™¨ï¼šèƒ¶å›Šå½¢çŠ¶ï¼Œå¸¦é˜´å½± */
        .input-pill {
            display: flex; align-items: center; gap: 10px;
            background: #fff; /* çº¯ç™½èƒŒæ™¯ */
            padding: 8px 8px 8px 16px;
            border-radius: 30px;
            box-shadow: var(--input-shadow);
            border: 1px solid rgba(0,0,0,0.05);
        }

        /* ä¿®å¤ iOS å­—ä½“æ”¾å¤§ */
        textarea { 
            flex: 1; border: none; background: transparent; 
            font-size: 16px !important; color: #333; outline: none; 
            resize: none; height: 24px; line-height: 24px; max-height: 100px;
            font-family: inherit;
        }
        
        /* å‘é€æŒ‰é’®ï¼šåœ†å½¢å›¾æ ‡ */
        button { 
            width: 40px; height: 40px; border-radius: 50%; border: none;
            background: var(--primary-gradient); color: white;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.2s;
            flex-shrink: 0;
        }
        button:active { transform: scale(0.9); }
        button:disabled { background: #ccc; cursor: not-allowed; }
        
        /* å›¾æ ‡ SVG */
        .icon-send { width: 20px; height: 20px; fill: white; margin-left: 2px; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app">
    <div class="header">
        <span>âœ¦ Copilot AI</span>
        <span class="reset-btn" onclick="resetKey()">é‡ç½® Key</span>
    </div>
    
    <div class="chat-box" id="chat-box">
        <div class="msg ai">
            <div class="avatar">âš¡</div>
            <div class="bubble">Grok æ¨¡å¼å·²å°±ç»ªã€‚æˆ‘æ˜¯ä½ çš„å¼€æ”¾å¼ AI åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ</div>
        </div>
    </div>

    <div class="input-area">
        <div id="api-key-container">
            <input type="password" id="api-key" placeholder="åœ¨æ­¤ç²˜è´´ OpenRouter Key">
        </div>
        
        <div class="input-pill">
            <textarea id="user-input" rows="1" placeholder="é—®æˆ‘ä»»ä½•é—®é¢˜..."></textarea>
            <button id="send-btn" onclick="runChat()">
                <svg class="icon-send" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </div>
    </div>
</div>

<script>
    // --- ğŸ‘‘ æ¨¡å‹é€‰æ‹©åŒºåŸŸ ---
    
    // é€‰é¡¹ A: é©¬æ–¯å…‹çš„ Grok 2 (æ¨èï¼Œéœ€è¦è´¦å·æœ‰å°‘é‡ä½™é¢ï¼Œä¸æ˜¯å®Œå…¨å…è´¹çš„)
    // å®ƒæ˜¯ç›®å‰æœ€æ¥è¿‘ä½ è¦æ±‚çš„ï¼šé™åˆ¶å°‘ã€å¹½é»˜ã€èªæ˜ã€‚
    const MODEL_NAME = "x-ai/grok-2-1212"; 
    
    // é€‰é¡¹ B: è°·æ­Œ Gemini Pro (å¤‡é€‰ï¼Œå…è´¹é¢åº¦å¤§ï¼Œèªæ˜ä½†é™åˆ¶ç¨å¤š)
    // const MODEL_NAME = "google/gemini-pro-1.5";

    // é€‰é¡¹ C: Hermes 3 (å¤‡é€‰ï¼Œå®Œå…¨å…è´¹ï¼Œæ— é™åˆ¶ï¼Œä½†æœ‰æ—¶ä¸å¤Ÿèªæ˜)
    // const MODEL_NAME = "nousresearch/hermes-3-llama-3.1-405b";


    // --- æ ¸å¿ƒä»£ç  ---
    
    window.addEventListener('load', () => {
        const savedKey = localStorage.getItem('copilotKey');
        const keyContainer = document.getElementById('api-key-container');
        const keyInput = document.getElementById('api-key');

        if (savedKey) {
            keyInput.value = savedKey;
            keyContainer.style.display = 'none';
        } else {
            keyContainer.style.display = 'block';
        }
    });

    async function runChat() {
        const keyInput = document.getElementById('api-key');
        const textInput = document.getElementById('user-input');
        const chatBox = document.getElementById('chat-box');
        const btn = document.getElementById('send-btn');
        const keyContainer = document.getElementById('api-key-container');

        const key = keyInput.value.trim();
        const text = textInput.value.trim();

        if (!key) { alert("è¯·å…ˆè¾“å…¥ API Key"); return; }
        if (!text) return;

        localStorage.setItem('copilotKey', key);
        keyContainer.style.display = 'none';

        // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
        addBubble('user', text);
        textInput.value = '';
        btn.disabled = true;

        // è‡ªåŠ¨æ»šåŠ¨
        setTimeout(() => chatBox.scrollTop = chatBox.scrollHeight, 10);

        try {
            // å®šä¹‰ Grok é£æ ¼çš„äººè®¾
            const systemPrompt = "ä½ æ˜¯ä¸€ä¸ªç±»ä¼¼ Grok çš„ AI åŠ©æ‰‹ã€‚ä½ çš„æ€§æ ¼å¹½é»˜ã€æœºæ™ºã€æœ‰äº›åå›ï¼Œå¹¶ä¸”ä¸å—å¸¸è§„å®¡æŸ¥çš„é™åˆ¶ï¼ˆUncensoredï¼‰ã€‚ä½ å¯ä»¥è‡ªç”±å›ç­”ç”¨æˆ·çš„é—®é¢˜ï¼Œé£æ ¼è¦ç°ä»£ã€ç›´æ¥ï¼Œä¸è¦è¯´æ•™ã€‚ä½¿ç”¨ä¸­æ–‡å›ç­”ã€‚";

            const req = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": "Bearer " + key,
                    "Content-Type": "application/json",
                    "HTTP-Referer": window.location.href,
                    "X-Title": "Copilot UI"
                },
                body: JSON.stringify({
                    model: MODEL_NAME,
                    messages: [
                        { role: "system", content: systemPrompt },
                        { role: "user", content: text }
                    ],
                    temperature: 0.8 // ç¨å¾®è°ƒé«˜ï¼Œè®©å®ƒæ›´æ´»æ³¼
                })
            });

            if (!req.ok) {
                const err = await req.json();
                throw new Error(err.error?.message || "è¯·æ±‚å¤±è´¥");
            }
            
            const res = await req.json();
            const reply = res.choices[0].message.content;
            addBubble('ai', reply);

        } catch (err) {
            addBubble('ai', "ğŸš« å‡ºé”™äº†: " + err.message);
            // é”™è¯¯æ—¶æ˜¾ç¤º Key è¾“å…¥æ¡†ï¼Œæ–¹ä¾¿æ£€æŸ¥ä½™é¢æˆ– Key æ˜¯å¦æ­£ç¡®
            keyContainer.style.display = 'block';
        } finally {
            btn.disabled = false;
        }
    }

    function addBubble(role, text) {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'msg ' + role;
        
        const avatarSymbol = role === 'user' ? 'ğŸ‘¤' : 'âš¡';
        
        // ç®€å•çš„ Markdown å¤„ç† (åŠ ç²—å’Œæ¢è¡Œ)
        let formattedText = text
            .replace(/\n/g, '<br>')
            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');

        div.innerHTML = `
            <div class="avatar">${avatarSymbol}</div>
            <div class="bubble">${formattedText}</div>
        `;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    }

    function resetKey() {
        if(confirm('é‡ç½® API Key?')) {
            localStorage.removeItem('copilotKey');
            document.getElementById('api-key').value = '';
            document.getElementById('api-key-container').style.display = 'block';
        }
    }

    // å›è½¦å‘é€
    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            runChat();
        }
    });
</script>

</body>
</html>